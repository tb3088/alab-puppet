---
version: 5

defaults:
  data_hash: yaml_data
  datadir: hieradata

# https://docs.puppet.com/hiera/3.1/variables.html#where-to-interpolate-data
#https://codingbee.net/tutorials/puppet/puppet-working-with-a-dynamic-hiera-yaml-file
# first match wins!, puppet automaticlaly exposes all facters and 'puppet config print' items
hierarchy:
# need node, role, instance
  - name: node
    path: "node/%{trusted.certname}.yaml"
    # think of as specific Assist apps
#  - name: Application
#    path: app/reports.yaml
  - name: lab
    # eg. GLAB#, VLAB#, $userid
    path: "environment/%{facts.'tags.lab'}.yaml"
  - name: environment"
    # eg. PI#, 
    path: "environment/%{facts.puppet.environment}.yaml"
  - name: instance
    # think of as JBoss|CATALINA_BASE, which can have
    # multiple JAVA_HOME(s) and application(s)
    # eg. rbass07, 
    path: "instance/%{facts.'tags.puppet.instance'}.yaml"
  - name: role
    # think of as generic JBoss|CATALINA server
    path: "role/%{facts.'tags.puppet.role'}.yaml"
  - name: os.name
    path: "os/%{facts.os.name}.yaml"
  - name: os.family
    path: "os/%{facts.os.family}.yaml"
  - name: os.platform
    paths:
      - "os/%{facts.kernel}.yaml"
      - os/unix.yaml
    #TODO rename yaml and disperse app stuff to it's module?
    # reorganize and use lookup() and configure lookup_options like 'os'
    #FIXME these are misnamed and mis-placed
  - name: version
    path: versions.yaml
  - name: datasource
    path: datasources.yaml
  - name: common
    path: common.yaml

#  - name: "instances"
#    path: "instance/%{facts.'tags.puppet.instance'}.yaml"
#  - name: "roles"
#    path: "role/%{facts.'tags.puppet.role'}.yaml"


# to merge Arrays & Hashes; 'hiera --merge-array-hash ...'
#XXX need 'gem install deep_merge' for it to work?

